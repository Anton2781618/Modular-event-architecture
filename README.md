# Модульная событийная архитектура с UniRx

Этот проект — современная модульно-событийная архитектура для Unity с поддержкой UniRx, EventBus, GameEntity и системой модулей. Позволяет создавать гибкие, реактивные и расширяемые игровые системы.

## Версия и требования

- Версия: 1.1.0
- Требуемая версия Unity: 2022.3+
- Зависимости: TextMeshPro 3.0.6, UniRx 7.1.0

## Основные компоненты

### Система событий (Event System)

В проекте реализована реактивная система событий на базе UniRx:
- `GlobalEventBus` — для глобальных событий, доступных всей игре
- `LocalEventBus` — для локальных событий внутри сущности

#### Типы событий

События определяются через интерфейс `IEventType`:
```csharp
public interface IEventType
{
    int Id { get; }
    string EventName { get; }
}
```

#### Добавление новых типов событий

Чтобы добавить новые события в систему:

Создайте новый класс, реализующий интерфейс `IEventType`:
```csharp
public class YourEventsType : IEventType
{
    private string _eventName;
    
    private YourEventsType(string eventName)
    {
        _eventName = eventName;
    }
    
    public int Id => ("YourEventsType_" + EventName).GetHashCode();
    public string EventName => _eventName;
    
    public static readonly IEventType YourEvent1 = new YourEventsType("YourEvent1");
    public static readonly IEventType YourEvent2 = new YourEventsType("YourEvent2");
}
```

#### Использование событий

```csharp
// Подписка на событие (реактивно, с автоматической отпиской)
GlobalEventBus.Instance.Observe<EventBase>(BasicActionsTypes.SystemRequirements.Test_Event)
    .Subscribe(OnTestEvent)
    .AddTo(this); // автоматическая отписка при уничтожении объекта

// Публикация события
GlobalEventBus.Instance.Publish(BasicActionsTypes.Commands.Unit_Created, new CreateUnitEvent { Unit = this });
```

### Игровые сущности (Game Entities)

Проект использует иерархию классов сущностей:

- `GameEntity` - базовый класс для всех игровых сущностей
- `ManagerEntity` - базовый класс для менеджеров
- `UIEntity` - базовый класс для UI элементов
- `UnitEntity` - базовый класс для игровых юнитов

### GameEntity

`GameEntity` — основной класс для игровых сущностей. Включает:
- Автоматическую реактивную подписку на события через UniRx
- Автоматическую отписку при уничтожении или отключении объекта
- Модульную систему для расширения функционала

### Модульная система

Проект использует модульную архитектуру, где каждая сущность может иметь множество модулей:

```csharp
public class YourEntity : GameEntity
{
    protected override void Initialize()
    {
        // Добавляем модули
        AddModule(new YourModule());
    }
}
```

### Менеджеры

В проекте реализованы различные менеджеры:
- `GameManager` - управление игровым процессом
- `LevelManager` - управление уровнем и сущностями на нем
- `NetworkManager` - управление сетевым взаимодействием
- `QuestManager` - управление квестами
- `SaveManager` - управление сохранениями
- `UIManager` - управление пользовательским интерфейсом

### Атрибуты совместимости

Для указания совместимости модулей с сущностями используются атрибуты:
- `[CompatibleUnit]` - указывает, с какими типами сущностей совместим модуль
- `[IncompatibleUnit]` - указывает, с какими типами сущностей несовместим модуль

## Примеры модулей

Проект включает несколько примеров модулей:
- Модуль инвентаря - базовая система инвентаря с настраиваемым количеством слотов
- Модуль диалогов - система диалогов с поддержкой автопропуска
- События для RPG - набор событий для RPG проекта
- Сетевой модуль - базовая реализация сетевого взаимодействия

## Лучшие практики

1. Используйте `LocalEventBus` для событий внутри сущности, `GlobalEventBus` — для глобальных событий
2. Подписывайтесь на события через `.Subscribe(...).AddTo(this)` — это гарантирует автоматическую отписку
3. Не используйте потоки для работы с Unity API — все обращения к объектам должны быть в главном потоке
4. Создавайте отдельные классы данных событий, реализующие `IEventData`
5. Используйте атрибуты `[CompatibleUnit]` и `[IncompatibleUnit]` для указания совместимости модулей
6. Кэшируйте компоненты через `GetCachedComponent<T>()` для оптимизации

## Примечания

- Система автоматически управляет жизненным циклом подписок через UniRx и `.AddTo(this)`
- Все события типобезопасны благодаря интерфейсу `IEventData`
- Система поддерживает добавление новых типов событий без изменения существующего кода
- Модульный подход позволяет легко расширять функциональность сущностей
- `GameEntity` — основной класс для создания игровых сущностей и управления модулями
- Модуль `EntityLifecycleModule` автоматически отслеживает создание и уничтожение сущностей

## Установка

1. Добавьте пакет через Package Manager или склонируйте репозиторий
2. Убедитесь, что UniRx установлен (через UPM или вручную)
3. Используйте namespace `ModularEventArchitecture` в своих скриптах
4. Наследуйтесь от `GameEntity` для создания игровых сущностей
5. Создавайте модули, наследуясь от `ModuleBase`

## Репозиторий

Исходный код доступен на GitHub: https://github.com/Anton2781618/Modular-event-architecture.git